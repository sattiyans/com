---
// GitHub Streak component - shows coding streak based on commits
---

<div class="animate">
  <div id="github-streak" class="flex items-center gap-2 text-xs">
    <!-- Loading skeleton -->
    <div class="animate-pulse flex items-center gap-2">
      <div class="w-3 h-3 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
      <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-24"></div>
    </div>
  </div>
</div>

<script>
  async function loadGitHubStreak() {
    try {
      const response = await fetch('/api/github-streak');
      const data = await response.json();
      
      const container = document.getElementById('github-streak');
      if (!container) return;
      
      if (data.error) {
        container.innerHTML = `
          <div class="inline-flex items-center gap-2 px-3 py-1 bg-red-50 dark:bg-red-900/20 rounded-full text-xs font-medium whitespace-nowrap">
            <div class="w-1.5 h-1.5 bg-red-400 rounded-full"></div>
            <span class="text-red-700 dark:text-red-300">Unable to load</span>
          </div>
        `;
        return;
      }
      
      const { currentStreak, longestStreak, thisYearCommits } = data;
      
      // Determine streak status and colors
      let streakText, dotColor, icon;
      
      if (currentStreak === 0) {
        streakText = "No recent commits";
        dotColor = "bg-gray-400";
        icon = "ðŸ“Š";
      } else if (currentStreak >= 7) {
        streakText = `${currentStreak} day streak`;
        dotColor = "bg-orange-500";
        icon = "ðŸ”¥";
      } else if (currentStreak >= 3) {
        streakText = `${currentStreak} day streak`;
        dotColor = "bg-yellow-500";
        icon = "âš¡";
      } else {
        streakText = `${currentStreak} day streak`;
        dotColor = "bg-green-500";
        icon = "ðŸ’»";
      }
      
      container.innerHTML = `
        <a href="https://github.com/sattiyans" target="_blank" rel="noopener noreferrer" class="group inline-flex items-center gap-2 px-4 py-2 bg-gray-50 dark:bg-gray-900 rounded-full text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200 whitespace-nowrap">
          <div class="flex items-center gap-1.5">
            <span class="text-sm group-hover:animate-pulse">${icon}</span>
            <div class="w-2 h-2 ${dotColor} rounded-full group-hover:animate-pulse"></div>
          </div>
          <span class="text-gray-700 dark:text-gray-300 truncate max-w-[300px]">${streakText}</span>
          <span class="text-gray-500 dark:text-gray-400 text-sm">${thisYearCommits} this year</span>
        </a>
      `;
    } catch (error) {
      console.error('Error loading GitHub streak:', error);
      const container = document.getElementById('github-streak');
      if (container) {
        container.innerHTML = `
          <div class="inline-flex items-center gap-2 px-3 py-1 bg-red-50 dark:bg-red-900/20 rounded-full text-xs font-medium whitespace-nowrap">
            <div class="w-1.5 h-1.5 bg-red-400 rounded-full"></div>
            <span class="text-red-700 dark:text-red-300">Unable to load</span>
          </div>
        `;
      }
    }
  }
  
  // Load GitHub streak data when the component is visible
  document.addEventListener('DOMContentLoaded', loadGitHubStreak);
  
  // Refresh every 2 hours (GitHub data doesn't change frequently)
  setInterval(loadGitHubStreak, 7200000);
  
  // Refresh when page becomes visible
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden) {
      loadGitHubStreak();
    }
  });
</script>
