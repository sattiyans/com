---
// GitHub Streak component - shows coding streak based on commits
---

<div class="animate">
  <div id="github-streak" class="flex items-center gap-2 text-xs">
    <!-- Loading skeleton -->
    <div class="animate-pulse flex items-center gap-2">
      <div class="w-3 h-3 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
      <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-24"></div>
    </div>
  </div>
</div>

<script>
  async function loadGitHubStreak() {
    try {
      const response = await fetch('/api/github-streak');
      const data = await response.json();
      
      const container = document.getElementById('github-streak');
      if (!container) return;
      
      if (data.error) {
        container.innerHTML = `
          <div class="inline-flex items-center gap-2 px-3 py-1 bg-red-50 dark:bg-red-900/20 rounded-full text-xs font-medium whitespace-nowrap">
            <div class="w-1.5 h-1.5 bg-red-400 rounded-full"></div>
            <span class="text-red-700 dark:text-red-300">Unable to load</span>
          </div>
        `;
        return;
      }
      
      const { currentStreak, longestStreak, thisYearCommits } = data;
      
      // Determine streak status and colors
      let streakText, bgColor, textColor, dotColor, icon;
      
      if (currentStreak === 0) {
        streakText = "No recent commits";
        bgColor = "bg-gray-50 dark:bg-gray-900";
        textColor = "text-gray-500 dark:text-gray-400";
        dotColor = "bg-gray-400";
        icon = "ðŸ“Š";
      } else if (currentStreak >= 7) {
        streakText = `${currentStreak} day streak`;
        bgColor = "bg-orange-50 dark:bg-orange-900/20";
        textColor = "text-orange-700 dark:text-orange-300";
        dotColor = "bg-orange-500";
        icon = "ðŸ”¥";
      } else if (currentStreak >= 3) {
        streakText = `${currentStreak} day streak`;
        bgColor = "bg-yellow-50 dark:bg-yellow-900/20";
        textColor = "text-yellow-700 dark:text-yellow-300";
        dotColor = "bg-yellow-500";
        icon = "âš¡";
      } else {
        streakText = `${currentStreak} day streak`;
        bgColor = "bg-blue-50 dark:bg-blue-900/20";
        textColor = "text-blue-700 dark:text-blue-300";
        dotColor = "bg-blue-500";
        icon = "ðŸ’»";
      }
      
      container.innerHTML = `
        <a href="https://github.com/sattiyans" target="_blank" rel="noopener noreferrer" class="group inline-flex items-center gap-2 px-3 py-1 ${bgColor} rounded-full text-xs font-medium hover:opacity-80 transition-opacity duration-200 whitespace-nowrap">
          <div class="flex items-center gap-1">
            <span class="text-xs">${icon}</span>
            <div class="w-1.5 h-1.5 ${dotColor} rounded-full"></div>
          </div>
          <span class="${textColor} truncate max-w-[200px]">${streakText}</span>
          <span class="text-gray-500 dark:text-gray-400 text-xs">${thisYearCommits} this year</span>
        </a>
      `;
    } catch (error) {
      console.error('Error loading GitHub streak:', error);
      const container = document.getElementById('github-streak');
      if (container) {
        container.innerHTML = `
          <div class="inline-flex items-center gap-2 px-3 py-1 bg-red-50 dark:bg-red-900/20 rounded-full text-xs font-medium whitespace-nowrap">
            <div class="w-1.5 h-1.5 bg-red-400 rounded-full"></div>
            <span class="text-red-700 dark:text-red-300">Unable to load</span>
          </div>
        `;
      }
    }
  }
  
  // Load GitHub streak data when the component is visible
  document.addEventListener('DOMContentLoaded', loadGitHubStreak);
  
  // Refresh every 2 hours (GitHub data doesn't change frequently)
  setInterval(loadGitHubStreak, 7200000);
  
  // Refresh when page becomes visible
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden) {
      loadGitHubStreak();
    }
  });
</script>
