---
// Spotify Now Playing component - minimal version
---

<style>
  @keyframes music-wave {
    0%, 100% { transform: scaleY(0.3); }
    50% { transform: scaleY(1); }
  }
  
  .music-bar {
    animation: music-wave 1.2s ease-in-out infinite;
  }
  
  .music-bar:nth-child(1) { animation-delay: 0ms; }
  .music-bar:nth-child(2) { animation-delay: 150ms; }
  .music-bar:nth-child(3) { animation-delay: 300ms; }
  .music-bar:nth-child(4) { animation-delay: 450ms; }
  .music-bar:nth-child(5) { animation-delay: 600ms; }
</style>

<div class="animate">
  <div id="spotify-now-playing" class="flex items-center gap-2 text-xs">
    <!-- Loading skeleton -->
    <div class="animate-pulse flex items-center gap-2">
      <div class="w-3 h-3 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
      <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-24"></div>
    </div>
  </div>
</div>

<script>
  async function loadSpotifyData() {
    try {
      const response = await fetch('/api/spotify-now-playing');
      const data = await response.json();
      
      const container = document.getElementById('spotify-now-playing');
      if (!container) return;
      
      if (data.error || !data.isPlaying) {
        // Check if it's a credentials error
        if (data.error === 'Spotify credentials not configured') {
          container.innerHTML = `
            <div class="inline-flex items-center gap-2 px-3 py-1 bg-amber-50 dark:bg-amber-900/20 rounded-full text-xs font-medium">
              <div class="w-2 h-2 bg-amber-400 rounded-full"></div>
              <span class="text-amber-700 dark:text-amber-300">Spotify not configured</span>
            </div>
          `;
        } else {
          container.innerHTML = `
            <div class="inline-flex items-center gap-2 px-3 py-1 bg-gray-50 dark:bg-gray-900 rounded-full text-xs font-medium">
              <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
              <span class="text-gray-500 dark:text-gray-400">Not playing</span>
            </div>
          `;
        }
        return;
      }
      
      container.innerHTML = `
        <a href="${data.trackUrl}" target="_blank" rel="noopener noreferrer" class="group inline-flex items-center gap-2 px-3 py-1 bg-gray-50 dark:bg-gray-900 rounded-full text-xs font-medium hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">
          <div class="flex items-center gap-0.5 h-4">
            <div class="music-bar w-0.5 h-2 bg-green-500 rounded-full"></div>
            <div class="music-bar w-0.5 h-3 bg-green-500 rounded-full"></div>
            <div class="music-bar w-0.5 h-2 bg-green-500 rounded-full"></div>
            <div class="music-bar w-0.5 h-4 bg-green-500 rounded-full"></div>
            <div class="music-bar w-0.5 h-2 bg-green-500 rounded-full"></div>
          </div>
          <span class="text-gray-700 dark:text-gray-300 truncate max-w-[200px]">${data.trackName} - ${data.artistName}</span>
        </a>
      `;
    } catch (error) {
      console.error('Error loading Spotify data:', error);
      const container = document.getElementById('spotify-now-playing');
      if (container) {
        container.innerHTML = `
          <div class="inline-flex items-center gap-2 px-3 py-1 bg-red-50 dark:bg-red-900/20 rounded-full text-xs font-medium">
            <div class="w-2 h-2 bg-red-400 rounded-full"></div>
            <span class="text-red-700 dark:text-red-300">Unable to load</span>
          </div>
        `;
      }
    }
  }
  
  // Load Spotify data when the component is visible
  document.addEventListener('DOMContentLoaded', loadSpotifyData);
</script>
