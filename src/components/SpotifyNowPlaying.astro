---
// Spotify Now Playing component - minimal version
---

<div class="animate">
  <div id="spotify-now-playing" class="flex items-center gap-2 text-xs">
    <!-- Loading skeleton -->
    <div class="animate-pulse flex items-center gap-2">
      <div class="w-3 h-3 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
      <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-24"></div>
    </div>
  </div>
</div>

<script>
  async function loadSpotifyData() {
    try {
      const response = await fetch('/api/spotify-now-playing');
      const data = await response.json();
      
      const container = document.getElementById('spotify-now-playing');
      if (!container) return;
      
      if (data.error || !data.isPlaying) {
        // Check if it's a credentials error
        if (data.error === 'Spotify credentials not configured') {
          container.innerHTML = `
            <div class="flex items-center gap-2 text-amber-500 dark:text-amber-400">
              <div class="w-2 h-2 bg-amber-400 rounded-full"></div>
              <span>Spotify not configured</span>
            </div>
          `;
        } else {
          container.innerHTML = `
            <div class="flex items-center gap-2 text-gray-500 dark:text-gray-400">
              <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
              <span>Not playing</span>
            </div>
          `;
        }
        return;
      }
      
      container.innerHTML = `
        <a href="${data.trackUrl}" target="_blank" rel="noopener noreferrer" class="group flex items-center gap-2 hover:text-green-600 dark:hover:text-green-400 transition-colors duration-200">
          <div class="w-2 h-2 bg-green-500 rounded-full group-hover:animate-pulse"></div>
          <span class="truncate max-w-[200px]">${data.trackName} - ${data.artistName}</span>
        </a>
      `;
    } catch (error) {
      console.error('Error loading Spotify data:', error);
      const container = document.getElementById('spotify-now-playing');
      if (container) {
        container.innerHTML = `
          <div class="flex items-center gap-2 text-gray-500 dark:text-gray-400">
            <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
            <span>Unable to load</span>
          </div>
        `;
      }
    }
  }
  
  // Load Spotify data when the component is visible
  document.addEventListener('DOMContentLoaded', loadSpotifyData);
</script>
